<!DOCTYPE html>
<html>
<head>
  <title>File Upload</title>
</head>
<body>
  <form id="uploadForm" enctype="multipart/form-data">
	<input type="file" name="file" id="file">
	<input type="submit" value="Upload">
  </form>

  <script>
const uploadForm = document.getElementById('uploadForm');
const fileInput = document.getElementById('file');

uploadForm.addEventListener('submit', (e) => {
  e.preventDefault();

  const file = fileInput.files[0];
  if (!file) {
    alert('Please select a file.');
    return;
  }

  const chunkSize = 1024; // Chunk size in bytes (e.g., 1 MB)
  let offset = 0;

  function uploadChunk() {
    const chunk = file.slice(offset, offset + chunkSize);
    const isLastChunk = offset + chunkSize >= file.size;

    const formData = new FormData();
    formData.append('file', chunk, file.name);

    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/chunked_request_testing', true);

    if (!isLastChunk) {
      xhr.setRequestHeader('Transfer-Encoding', 'chunked');
    }

    xhr.onload = function () {
      if (xhr.status === 200) {
        if (isLastChunk) {
          console.log('Upload completed!');
        } else {
          offset += chunkSize;
          uploadChunk();
        }
      } else {
        console.error('Error:', xhr.status);
      }
    };

    xhr.send(formData);
  }

  uploadChunk();
});
  </script>
</body>
</html>
